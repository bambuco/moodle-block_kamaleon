{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/ //\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * General features.\n *\n * @module    block_kamaleon/main\n * @copyright 2024 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport horizontalSlider from 'block_kamaleon/horizontalslider';\nimport Log from 'core/log';\nimport Modal from 'core/modal';\nimport ModalEvents from 'core/modal_events';\n\n/**\n * Component initialization.\n */\nexport const initSlider = () => {\n\n    $(\".kam-hslider\").each(function() {\n        var $this = $(this);\n\n        var prop = {\n            \"animation\": \"slide\",\n            \"itemMargin\": 15,\n            \"selector\": \"section > *\",\n        };\n\n        if ($this.attr('data-autoplay') && $this.attr('data-autoplay') == 'true') {\n            prop.slideshow = true;\n        } else {\n            prop.slideshow = false;\n        }\n\n        if ($this.attr('data-loop') && $this.attr('data-loop') == 'true') {\n            prop.animationLoop = true;\n        }\n\n        if ($this.attr('data-width')) {\n            prop.itemWidth = parseInt($this.attr('data-width'));\n        } else {\n            var $element = $this.find(prop.selector);\n            var itemwidth = $element.css('width');\n\n            if (itemwidth) {\n                prop.itemWidth = parseInt(itemwidth);\n            } else {\n                prop.itemWidth = $element.width();\n            }\n        }\n\n        horizontalSlider.init($this, prop);\n    });\n};\n\n/**\n * Initialize open in modal feature.\n */\nexport const initOpenInModal = () => {\n    $(\".kam-openinmodal\").each(function() {\n        var $this = $(this);\n        $this.on('click', function(event) {\n            event.preventDefault();\n\n            const $link = $(this);\n\n            const dialogue = $link.data('dialogue');\n\n            if (!dialogue) {\n\n                var w = $this.attr('data-property-width');\n                var h = $this.attr('data-property-height');\n\n                var href = $link.attr('href');\n                var url = href + (href.indexOf('?') === -1 ? '?' : '&') + 'inpopup=true';\n                var $iframe = $('<iframe class=\"bbco-openinmodal-container\"></iframe>');\n                $iframe.attr('src', url);\n                $iframe.on('load', function() {\n                    $iframe.contents().find('a:not([target])').attr('target', '_top');\n                });\n\n                var el = $.fn.hide;\n                $.fn.hide = function() {\n                    this.trigger('hide');\n                    return el.apply(this, arguments);\n                };\n\n                var $floatwindow = $('<div></div>');\n\n                $floatwindow.append($iframe);\n\n                var properties = {\n                    width: '95vw',\n                    height: '95vh',\n                };\n\n                if (w) {\n                    if (w.indexOf('%') >= 0) {\n                        var windowW = $(window).width();\n                        var tmpW = Number(w.replace('%', ''));\n                        if (!isNaN(tmpW) && tmpW > 0) {\n                            w = tmpW * windowW / 100;\n                        }\n                    }\n\n                    if (!isNaN(w)) {\n                        w += 'px';\n                    }\n\n                    properties.width = w;\n                }\n\n                if (h) {\n                    if (h.indexOf('%') >= 0) {\n                        var windowH = $(window).height();\n                        var tmpH = Number(h.replace('%', ''));\n                        if (!isNaN(tmpH) && tmpH > 0) {\n                            h = tmpH * windowH / 100;\n                        }\n                    }\n\n                    if (!isNaN(h)) {\n                        h += 'px';\n                    }\n\n                    properties.height = h;\n                }\n\n                Modal.create({\n                    body: $iframe,\n                    title: $link.attr('title') || $link.text(),\n                })\n                .then(function(modal) {\n\n                    // When the dialog is closed, pause video and audio.\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        $iframe.contents().find('video, audio').each(function() {\n                            this.pause();\n                        });\n                    });\n\n                    modal.getRoot().find('> .modal-dialog').attr('style', 'width: ' + properties.width +\n                                                                    '; height: ' + properties.height + ';')\n                                                                    .addClass('bbco-modal-dialog');\n                    modal.show();\n                    $link.data('dialogue', modal);\n\n                    return modal;\n                })\n                .catch(function(e) {\n                    Log.debug('Error creating modal');\n                    Log.debug(e);\n                });\n\n            } else {\n                dialogue.show();\n            }\n        });\n    });\n};\n"],"names":["_interopRequireDefault","e","__esModule","default","_jquery","_horizontalslider","_log","_modal","_modal_events","_exports","initSlider","$","each","$this","this","prop","animation","itemMargin","selector","attr","slideshow","animationLoop","itemWidth","parseInt","$element","find","itemwidth","css","width","horizontalSlider","init","initOpenInModal","on","event","preventDefault","$link","dialogue","data","show","w","h","href","url","indexOf","$iframe","contents","el","fn","hide","trigger","apply","arguments","append","properties","height","windowW","window","tmpW","Number","replace","isNaN","windowH","tmpH","Modal","create","body","title","text","then","modal","getRoot","ModalEvents","hidden","pause","addClass","catch","Log","debug"],"mappings":"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"}